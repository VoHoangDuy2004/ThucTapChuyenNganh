<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{home/layout}"
>
<head>
    <title th:text="${product != null ? product.title : 'Chi tiết Sản phẩm'}">Chi tiết Sản phẩm</title>
    <meta charset="utf-8">
    <style>
        .product-qty .btn {
            opacity: 1 !important;
            visibility: visible !important;
        }
    </style>
</head>
<body>
<main layout:fragment="main-content">

    <section class="hero-section bg-gray d-flex align-items-center justify-content-center padding-medium pb-5">
        <div class="hero-content">
            <div class="container">
                <div class="row">
                    <div class="text-center padding-medium no-padding-bottom">
                        <h1 th:text="${product != null ? product.title : 'Sản phẩm'}">Tên Sản phẩm</h1>
                        <div class="breadcrumbs">
                            <span class="item">
                              <a th:href="@{/}">Home ></a>
                            </span>
                            <span class="item" th:if="${product != null and product.category != null}">
                                <a th:href="@{/shop/category/{id}(id=${product.category.id})}"
                                   th:text="${product.category.title}">Danh mục ></a>
                            </span>
                            <span class="item" th:text="${product != null ? product.title : 'Chi tiết'}">Tên Sản phẩm</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="product-detail" class="padding-xlarge pt-5">
        <div class="container">
            <th:block th:if="${product != null}">

                <div class="row gx-5">

                    <div class="col-lg-6">
                        <img th:src="@{${product.image}}"
                             th:alt="${product.title}"
                             class="img-fluid rounded shadow"
                             style="width:100%; max-height:800px; object-fit:contain; background:white;"
                             onerror="this.onerror=null;this.src='/images/no-image.jpg'">
                    </div>

                    <div class="col-lg-6 product-summary">

                        <h1 class="display-5 fw-bold mb-3" th:text="${product.title}">Tên Sản phẩm</h1>

                        <div class="price-block mb-4">
                        <span class="fs-2 fw-bold"
                              style="color: #ee4d2d;"
                              th:text="${#numbers.formatDecimal(product.price, 0, 'POINT', 0, 'COMMA')} + '₫'">100.000₫</span>
                        </div>

                        <div class="action-block mb-5 d-flex align-items-center">

                            <div class="product-qty d-flex me-3">
                                <input type="button" value="-"
                                       class="btn btn-outline-secondary quantity-left-minus"
                                       data-field="quantity">

                                <input type="text" id="quantity" name="quantity"
                                       class="form-control text-center"
                                       value="1" min="1" style="width: 60px;">

                                <input type="button" value="+"
                                       class="btn btn-outline-secondary quantity-right-plus"
                                       data-field="quantity">
                            </div>

                            <a href="#" class="btn btn-sm"
                               style="background-color: #ee4d2d; border-color: #ee4d2d; color: white; width: 200px;max-width: 100%;">
                                <i class="bi bi-cart-fill me-2"></i> Mua Ngay
                            </a>
                        </div>

                        <ul class="list-unstyled product-meta fs-6">
                            <li th:if="${product.category != null}" class="mb-1">
                                <span class="fw-bold">Danh Mục:</span>
                                <a th:href="@{/shop/category/{id}(id=${product.category.id})}"
                                   th:text="${product.category.title}" class="text-decoration-none text-dark"></a>
                            </li>
                            <li th:if="${product.author != null and !product.author.isEmpty()}" class="mb-1">
                                <span class="fw-bold">Tác Giả:</span> <span th:text="${product.author}"></span>
                            </li>
                            <li th:if="${product.publisher != null and !product.publisher.isEmpty()}" class="mb-1">
                                <span class="fw-bold">Nhà Xuất Bản:</span> <span th:text="${product.publisher}"></span>
                            </li>
                        </ul>

                        <h5 class="mt-3 mb-2 fw-bold">Mô tả chi tiết:</h5>
                        <div th:utext="${product.description}" class="text-muted mb-4">Nội dung mô tả chi tiết sách...</div>

                    </div>
                </div> </th:block>

            <th:block th:unless="${product != null}">
                <div class="text-center py-5">
                    <h2 class="text-danger">Sản phẩm không tồn tại.</h2>
                    <p>Vui lòng quay lại trang <a th:href="@{/shop}">Shop</a>.</p>
                </div>
            </th:block>
        </div>
    </section>

    <section id="products" class="product-store position-relative padding-xlarge pb-0">
        <div class="container display-header d-flex flex-wrap justify-content-between pb-4">
            <h3 class="mt-3">Sản phẩm cùng thể loại</h3>
            <div class="btn-right d-flex flex-wrap align-items-center">
                <a th:if="${product != null and product.category != null}"
                   th:href="@{/shop/category/{id}(id=${product.category.id})}"
                   class="btn me-5">Xem tất cả →</a>
            </div>
        </div>

        <div th:if="${products != null and !products.isEmpty()}">
            <div class="swiper product-swiper">
                <div class="swiper-wrapper">
                    <th:block th:each="p : ${products}">
                        <div class="swiper-slide">
                            <div class="product-card text-center">
                                <div class="image-holder">
                                    <a th:href="@{/product/{id}(id=${p.id})}">
                                        <img th:if="${p.image != null and !p.image.isEmpty()}"
                                             th:src="@{${p.image}}"
                                             alt="product"
                                             class="img-fluid rounded shadow-sm mx-auto"
                                             style="width:100%; max-width:280px; height:420px; object-fit:cover;"
                                             onerror="this.onerror=null;this.src='/images/no-image.jpg'">
                                    </a>
                                </div>
                                <div class="card-detail text-center pt-3 pb-2">
                                    <h5 class="card-title fs-5 text-uppercase m-0">
                                        <a th:href="@{/product/{id}(id=${p.id})}" th:text="${p.title}">Tên sách</a>
                                    </h5>
                                    <span class="item-price text-primary fs-4"
                                          th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'COMMA')} + '₫'"></span>
                                </div>
                            </div>
                        </div>
                    </th:block>
                </div>
            </div>
            <div class="swiper-buttons text-center mt-3">
                <button class="swiper-prev product-prev me-2">
                    <svg width="41" height="41"><use href="#angle-left"></use></svg>
                </button>
                <button class="swiper-next product-next">
                    <svg width="41" height="41"><use href="#angle-right"></use></svg>
                </button>
            </div>
        </div>

        <div th:unless="${products != null and !products.isEmpty()}" class="text-center py-4 text-muted">
            <p>Không tìm thấy sản phẩm cùng thể loại nào khác.</p>
        </div>
    </section>

    <section id="newsletter" class="bg-gray padding-medium">
    </section>
</main>
</body>
</html>